<!DOCTYPE html>
<html>

<head>
    <title>Test Statistics Flow</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }

        #logs {
            background: #f0f0f0;
            padding: 10px;
            margin-top: 20px;
        }

        .log {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <h1>Test Statistics Button Flow</h1>
    <button id="statsBtn">ðŸ“ˆ EstadÃ­sticas</button>
    <button id="clearBtn">Clear Logs</button>
    <div id="logs"></div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let viewMode = 'main';
        let statistics = null;
        let statsLoading = false;

        function log(msg) {
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('logs').appendChild(div);
        }

        async function fetchStatistics(silent = false) {
            log(`fetchStatistics called with silent=${silent}`);
            if (!silent) statsLoading = true;

            try {
                log(`Fetching from ${API_BASE}/statistics`);
                const response = await fetch(`${API_BASE}/statistics`);
                log(`Response status: ${response.status}`);

                if (!response.ok) {
                    throw new Error('Failed to load statistics');
                }

                const data = await response.json();
                log(`Data received with keys: ${Object.keys(data).join(', ')}`);
                statistics = data;

                if (!silent) {
                    log(`Setting viewMode to 'statistics'`);
                    viewMode = 'statistics';
                    log(`viewMode is now: ${viewMode}`);
                }
            } catch (err) {
                log(`ERROR: ${err.message}`);
            } finally {
                if (!silent) statsLoading = false;
            }
        }

        document.getElementById('statsBtn').addEventListener('click', () => {
            log('Button clicked!');
            fetchStatistics();
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            document.getElementById('logs').innerHTML = '';
        });

        log('Page loaded - ready to test');
    </script>
</body>

</html>